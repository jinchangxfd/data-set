#include "filter_cw_nar.h"

/** Hold the coefficents  calculated */
const float filter_coeff[FILTER_BUF] =
 {
  -0.009121829263530461,
  -0.042911401250929,
  -0.04327882022119251,
  -0.06393917247324932,
  -0.0771444946603805,
  -0.08651059778010739,
  -0.08759022118692389,
  -0.07869217954502064,
  -0.05888341521099791,
  -0.028751372259902968,
  0.009474078879558354,
  0.05221996136688144,
  0.09491358166920903,
  0.1325877487066411,
  0.16064390710775225,
  0.17563859678760424,
  0.17563859678760424,
  0.16064390710775225,
  0.1325877487066411,
  0.09491358166920903,
  0.05221996136688144,
  0.009474078879558354,
  -0.028751372259902968,
  -0.05888341521099791,
  -0.07869217954502064,
  -0.08759022118692389,
  -0.08651059778010739,
  -0.0771444946603805,
  -0.06393917247324932,
  -0.04327882022119251,
  -0.042911401250929,
  -0.009121829263530461
};

// OK
uint16_t firFilter1(uint16_t input)
{
	int i;
	static float buffer[FILTER_BUF];
	uint16_t result;

	float outwork;
	float inwork = ((input*3.2)/1024) - 1.6;

    for (i = (FILTER_BUF-1); i > 0; i--)
	{
		buffer[i] = buffer[i-1];
		outwork += buffer[i] * filter_coeff[i];
	}
	buffer[0] = inwork;
	outwork += buffer[0] * filter_coeff[0];

    result =  ((outwork + 1.6) *1024)/3.2;
    return result;
}
